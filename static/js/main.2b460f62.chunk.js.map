{"version":3,"sources":["registerServiceWorker.js","TagBar.js","Msg.js","TreatmentCard.js","HistoryDate.js","../../../aultfarms-lib/src/util/tagHelpers.js","HistoryTag.js","HistoryGroup.js","HistoryTime.js","Prefs.js","History.js","HistorySelector.js","TagPane.js","Keypad.js","Colorbar.js","TreatmentDateBar.js","RecordInput.js","TreatmentEditor.js","App.js","../../../aultfarms-lib/src/trello/module/errors.js","../../../aultfarms-lib/src/trello/module/sequences.js","../../../aultfarms-lib/src/treatments/module/sequences.js","../../../aultfarms-lib/src/treatments/module/index.js","../../../aultfarms-lib/src/incoming/module/sequences.js","../../../aultfarms-lib/src/incoming/module/index.js","../../../aultfarms-lib/src/dead/module/sequences.js","../../../aultfarms-lib/src/dead/module/index.js","../../../aultfarms-lib/src/trello/module/index.js","../../../aultfarms-lib/src/windowSize/module/sequences.js","../../../aultfarms-lib/src/windowSize/module/index.js","../../../aultfarms-lib/src/trello/provider/index.js","../../../aultfarms-lib/src/windowSize/provider/index.js","module/sequences.js","module/index.js","index.js"],"names":["isLocalhost","Boolean","window","location","hostname","match","registerValidSW","swUrl","navigator","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","state","controller","console","log","catch","error","connect","record","colors","msg","changeRecord","sequences","props","color","tag","className","style","borderColor","is_saved","value","type","onChange","evt","preventDefault","target","number","text","tags","length","treatment","_","map","t","i","key","historySelector","treatmentRecords","recordsfordate","filter","r","date","reverse","sortBy","dateLastActivity","count","reduce","sum","clone","recordindex","rangeContainsTag","start","end","group","find","tag_ranges","groups","asOfDate","arguments","undefined","allfound","g","filteredToDate","isAfter","sorted","tagStrToObj","str","matches","trim","tagObjToStr","incoming","taggroup","tagHelpers","groupForTag","records","recordsfortag","groupname","prevdays","days","moment","diff","daystr","prevstr","treatments","dead","sortBySignal","all_groups","each","keys","tagIndex","acc","tagstr","tagobj","numtrt","numdead","numalive","day","head","width","onClick","sort","perc","name","slice","format","numeral","extendMoment","Moment","deadRecords","today","lastmonth","range","subtract","lastthreemonths","lastyear","deadlastmonth","within","deadlastthreemonths","deadlastyear","totallastmonth","totallastthreemonths","totallastyear","logout","href","ret","active","historySelectionChangeRequested","windowSize","maxHeight","orientation","keyCode","this","onBackspace","onNumber","document","addEventListener","keypressed","bind","removeEventListener","n","onClear","arr","info","isObject","val","clicked","numberClicked","renderCalcRow","clearClicked","backspaceClicked","React","Component","c","k","colorButtonClicked","backgroundColor","treatmentCodes","showTreatmentEditor","treatmentTextClicked","recordsValid","saveRecord","canSave","num","prefix","hideTreatmentEditor","codelistFromText","tokens","code","on","textFromCodelist","list","join","recentTreatmentClicked","codesOn","keyBy","recent","includes","push","recentCodesFromRecords","thiscode","findIndex","treatmentEditorActive","trello","init","dir","flexDirection","_CerebralError","TrelloSaveError","apply","_CerebralError2","TrelloGetError","_CerebralError3","TrelloAuthorizeError","data","CARD_FIELDS","config","warnings","wForgottenReturn","_ref","authorize","e","message","JSON","stringify","stack","initialized","boards","lists","loadList","_ref2","try","boardName","get","fields","b","closed","result","board","post","concat","id","labels","listName","l","_ref3","cards","statePath","_ref4","store","set","reloadOneCard","_ref5","card","listname","idList","toLowerCase","putCard","_ref6","url","put","err","addLabelToCard","_ref7","idLabel","_templateObject8","saveTreatment","existing","cloneDeep","datematches","rest","treatmentmatches","split","cardName","fetchConfig","parse","desc","colorsCardToRecord","codesCardToRecord","parts","p","_p$trim$split","_p$trim$split2","propname","propval","replace","_$map","_$map2","computeStats","deadrecords","groupdeads","d","index","_templateObject13","_templateObject12","_templateObject11","_templateObject10","_templateObject9","tags_and_pens_str","note","tags_and_pens","tp","toUpperCase","toString","_$reduce","errors","reloadOneRecord","recordIndex","refreshedRecord","previous","newone","saveDead","add","isBefore","alreadyDead","existingDate","authorized","resized","isSmall","height","TrelloClientLoadError","check","Trello","delay","resolve","reject","persist","scope","read","write","expiration","success","deauthorize","path","params","_dimensions","innerWidth","innerHeight","seq","_M","dimensions","windowResized","context","sequencepath","updateMsg","sequence","historyGroupSortClicked","parallel","historyGroup","modules","treatmentsModule","incomingModule","deadModule","trelloModule","windowSizeModule","providers","trelloProvider","windowSizeProvider","trelloErrors","CerebralApp","AppModule","devtools","ReactDOM","render","app","getElementById","URL","process","origin","fetch","response","status","headers","indexOf","ready","unregister","reload","checkValidServiceWorker","registerServiceWorker"],"mappings":"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","file":"static/js/main.2b460f62.chunk.js","sourcesContent":["// In production, we register a service worker to serve assets from local cache.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on the \"N+1\" visit to a page, since previously\n// cached resources are updated in the background.\n\n// To learn more about the benefits of this model, read https://goo.gl/KwvDNy.\n// This link also includes instructions on opting out of this behavior.\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport default function register() {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebookincubator/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Lets check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://goo.gl/SC7cgQ'\n          );\n        });\n      } else {\n        // Is not local host. Just register service worker\n        registerValidSW(swUrl);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the old content will have been purged and\n              // the fresh content will have been added to the cache.\n              // It's the perfect time to display a \"New content is\n              // available; please refresh.\" message in your web app.\n              console.log('New content is available; please refresh.');\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      if (\n        response.status === 404 ||\n        response.headers.get('content-type').indexOf('javascript') === -1\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport {connect} from '@cerebral/react';\nimport {state,sequences} from 'cerebral/tags';\n\nimport './TagBar.css';\n\nexport default connect({\n  record: state`record`,\n  colors: state`treatments.colors`,\n     msg: state`msg`,\n  changeRecord: sequences`changeRecord`,\n}, function TagBar(props) {\n  const colorTextChanged = evt => {\n    evt.preventDefault();\n    props.changeRecord({tag: { color: evt.target.value} });\n  };\n\n  const tagNumberTextChanged = evt => {\n    evt.preventDefault();\n    props.changeRecord({tag: { number: +(evt.target.value)} });\n  };\n\n  const color = props.colors[props.record.tag.color];\n  return (\n    <div className=\"tagbar\"\n         style={{ borderColor: props.record.is_saved ? '#CCCCCC' : 'red' }}>\n      <input className=\"colortext\"\n             style={{ color: color, borderColor: color }}\n             value={props.record.tag.color}\n             type=\"text\"\n             onChange={colorTextChanged} />\n      <input className=\"numbertext\"\n             value={props.record.tag.number || ''} \n             type=\"text\" \n             onChange={tagNumberTextChanged} />\n    </div>\n  );\n\n});\n\n","import React from  'react';\nimport {connect} from '@cerebral/react';\nimport {state} from 'cerebral/tags';\n\nimport './Msg.css';\n\nexport default connect({\n  msg: state`msg`,\n}, function Msg(props) {\n  return (\n    <div className={'msg msg' + props.msg.type}>\n      {props.msg.text}\n    </div>\n   );\n});\n","import React from 'react';\nimport {connect} from '@cerebral/react';\nimport _ from 'lodash';\n\nimport './TreatmentCard.css';\n\nexport default connect({\n}, function TreatmentCard(props) { return (\n  <div className=\"treatmentcard\">\n    <div className=\"treatmentcardcount\">{props.record.tags.length} head</div>\n    -\n    <div className=\"treatmentcardtreatment\">{props.record.treatment}</div>\n    <div className=\"treatmentcardtags\">\n     {_.map(props.record.tags, (t,i) => \n        <div className=\"treatmentcardtag\" key={'treatmentcardtag'+i}>\n          {t.color+t.number}\n        </div>\n      )}\n    </div>\n  </div>\n)});\n\n","import React from 'react';\nimport _ from 'lodash';\n\nimport {connect} from '@cerebral/react';\nimport {state} from 'cerebral/tags';\n\nimport TreatmentCard from './TreatmentCard';\n\nexport default connect({\n   historySelector: state`historySelector`,\n  treatmentRecords: state`treatments.records`,\n            record: state`record`,\n}, function HistoryDate(props) {\n  // Show cards for current date:\n  let recordsfordate = _.filter(props.treatmentRecords, r=>(r.date === props.record.date));\n  recordsfordate = _.reverse(_.sortBy(recordsfordate,r=>r.dateLastActivity));\n\n  const count = _.reduce(recordsfordate, (sum,r) => sum + r.tags.length, 0);\n\n  return (\n    <div className=\"history\">\n      <div className=\"historytitle\">\n        {props.record.date+': '+count} head total.\n      </div>\n      {_.map(recordsfordate, (r,i) => \n        <TreatmentCard key={'treatmentcard'+i}\n                       record={_.clone(r)}\n                       recordindex={i} />\n      )}\n    </div>\n  );\n});\n\n","import _ from 'lodash';\nimport moment from 'moment'; // Note that a tag range is pre-processed to ensure that it\n// only has tags of the same color.  If there is a color\n// split on a group, the group will have 2 separate ranges.\n\nexport var rangeContainsTag = function rangeContainsTag(r, tag) {\n  return tag.color === r.start.color && tag.number >= r.start.number && tag.number <= r.end.number;\n};\nexport var groupContainsTag = function groupContainsTag(group, tag) {\n  //console.log('checking tag ',tag,' against group ranges ', group);\n  return _.find(group.tag_ranges, function (r) {\n    return rangeContainsTag(r, tag);\n  });\n}; // groupForTag has to deal with historic repeated tag color/number\n// combinations.  i.e. 3 years ago another \"RED13\" may have existed.\n// We need to figure out which one of these is the \"correct\" one.\n// This can be slightly fuzzy, because one or two mistakes is not\n// going to break the bank.\n//\n// The simplest algorithm is one that assumes there is only one\n// of each combo on-site at any given time.  Therefore, when a \n// new group comes in and gets tagged, they supercede any previous\n// version of that tag.  So the \"latest\" copy of the tag is always\n// the \"correct\" one for \"today\".\n//\n// Unfortunately, sometimes our scripts may want to compute historic death\n// loss and things like that.  \"historic\" means sometimes we're looking in \n// a date range that is not \"today\".  Therefore, we have to uglify this \n// function definition by adding a third optional parameter of \"asOfDate\"\n// which is the ballpark date of interest: i.e. it will take the tag number\n// as of that day.\n\nexport var groupForTag = function groupForTag(groups, tag) {\n  var asOfDate = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n  var allfound = _.filter(groups, function (g) {\n    return groupContainsTag(g, tag);\n  }); // if none, return false:\n\n\n  if (!allfound || allfound.length < 1) return false;\n  if (!asOfDate) asOfDate = moment(); // default to today\n  else asOfDate = moment(asOfDate, 'YYYY-MM-DD');\n\n  var filteredToDate = _.filter(allfound, function (g) {\n    return !moment(g.date, 'YYYY-MM-DD').isAfter(asOfDate);\n  }); // !isAfter = equal or before\n\n\n  if (!filteredToDate) {\n    console.log('WARNING: groupForTag: found multiple possible groups, but after filtering for date there were none left!');\n    return false;\n  }\n\n  var sorted = _.sortBy(filteredToDate, function (g) {\n    return g.date;\n  }); // default lexical sorting will put oldest on top, newest on bottom.  \n  // Need to take the newest one that is prior to the reference date\n\n\n  return sorted[sorted.length - 1];\n};\nexport var tagStrToObj = function tagStrToObj(str) {\n  var matches = str.trim().match(/^([A-Za-z]+) ?([0-9]+)?$/);\n  if (!matches) return {\n    color: 'NOTAG',\n    number: 1\n  };\n  return {\n    color: matches[1],\n    number: +matches[2] || 1\n  };\n};\nexport var tagObjToStr = function tagObjToStr(t) {\n  return !t ? '' : (t.color || '') + '' + (t.number || '');\n};","import React from 'react';\nimport _ from 'lodash';\nimport moment from 'moment';\nimport { tagHelpers } from 'aultfarms-lib/util'\n\nimport {connect} from '@cerebral/react';\nimport {state} from 'cerebral/tags';\n\nexport default connect({\n   historySelector: state`historySelector`,\n  treatmentRecords: state`treatments.records`,\n            record: state`record`,\n          incoming: state`incoming`,\n}, function HistoryTag(props) {\n  // find all records with this tag in it:\n  const taggroup = tagHelpers.groupForTag(props.incoming.records, props.record.tag, props.record.date);\n  let recordsfortag = _.filter(props.treatmentRecords, r => {\n    return _.find(r.tags, t => {\n      // must be the same tag color/number\n      if (!(t.number===props.record.tag.number && t.color===props.record.tag.color)) {\n        return false;\n      }\n      // tag number and color matches, check group;\n      const group = tagHelpers.groupForTag(props.incoming.records, t, r.date);\n      return (taggroup.groupname === group.groupname);\n    });\n  });\n  recordsfortag = _.reverse(_.sortBy(recordsfortag,r=>r.date));\nconsole.log('recordsfortag = ', recordsfortag);\n  let prevdays = -1; // keeps track of previous days in mapper\n  return (\n    <div className=\"historytag\">\n      {_.map(recordsfortag, (r,i) => {\n        const days = moment().diff(moment(r.date,'YYYY-MM-DD'), 'days');\n        let daystr = days + ' days ago';\n        if (days === 0) daystr = 'today';\n        if (days === 1) daystr = 'yesterday';\n        let prevstr = '(+'+(days-prevdays)+')';\n        if (prevdays < 0) prevstr = '';\n        prevdays = days;\n        return (\n        <div className=\"historytagentry\" key={'historyline'+i}>\n          <div className=\"historytreatment\">\n            {r.treatment}\n          </div>\n          <div className=\"historyduration\">\n            { daystr } { prevstr }\n          </div>\n        </div>\n      )})}\n    </div>\n  );\n});\n\n","import React from 'react';\nimport _ from 'lodash';\nimport numeral from 'numeral';\nimport moment from 'moment';\n\nimport {connect} from '@cerebral/react';\nimport {state,sequences} from 'cerebral/tags';\n\nimport {groupForTag} from 'aultfarms-lib/util/tagHelpers';\n\nimport './HistoryGroup.css';\n\nexport default connect({\n  historySelector: state`historySelector`,\n           groups: state`incoming.records`,\n       treatments: state`treatments`,\n             dead: state`dead`,\n           record: state`record`,\n           sortBy: state`historyGroup.sort`,\n  sortBySignal: sequences`historyGroupSortClicked`,\n}, function HistoryGroup(props) {\n  let all_groups = props.groups;\n  const group = groupForTag(props.groups, props.record.tag);\n  if (group) all_groups = [ group ]; // just show group for current tag\n\n  // For each group, compute Prob(dead), Prob(dead | 0 treatments), ...\n  // \"0 treatments\" could mean either \"received at least 0 treatments\" or \"received exactly  0\"\n  // I'm picking the \"exactly\" one for now\n  _.each(all_groups, g => {\n    const numdead = (g.dead ? g.dead.length : 0);\n    // treatments.tagIndex looks like:\n    // { <tagstr>: { <groupname>: { group: {...}, treatments: [ { treatment: \"ExDr\", date: \"2019-08-07\" } ] } }\n    // and the resulting new indexByNumTreatments will look like:\n    // [ 0: { dead: [ calves that died with 0 treatments }, alive: [ calves alive with 0 treatments ] }\n    // [ 1: { dead: [ calves that died with 1 treatment  }, alive: [ calves alive with 1 treatment ] }\n    // ....\n    const indexByNumTreatments = _.reduce(_.keys(props.treatments.tagIndex), (acc,tagstr) => {\n      const tagobj = props.treatments.tagIndex[tagstr];\n      const calf = tagobj[g.groupname];\n      if (!calf) return;\n      const isdead = props.dead.tagIndex[tagstr] ? props.dead.tagIndex[tagstr][g.groupname] : false;\n      const category = \"pd\"+tagobj.treatments.length; // pd0, pd1, pd2, ...\n      const numtrt = tagobj.treatments.length;\n      if (!acc[numtrt]) acc[numtrt] = { numdead: [], numalive: [] };\n      \n    }, []);\n  });\n\n  all_groups = _.sortBy(all_groups, g => {\n    if (props.sortBy === 'date') return g.day; // day string is lexicographic for sorting\n    if (props.sortBy === 'name') return g.groupname;\n    if (props.sortBy === 'head') return g.head;\n    if (props.sortBy === 'pd') return (g.dead ? g.dead.length : 0) / (g.head ? g.head : 1);\n    return g.day; // default\n  });\n  all_groups = _.reverse(all_groups); // other way seems better\n  return (\n    <div className=\"historygroup\">\n      { group ? ' Showing group for current tag: '+props.record.tag.color+props.record.tag.number : '' }\n      <table width=\"100%\">\n      <tbody>\n        <tr>\n          <th onClick={() => props.sortBySignal({ sort: 'name'})}>Name</th>\n          <th onClick={() => props.sortBySignal({ sort: 'days'})}>Days</th>\n          <th onClick={() => props.sortBySignal({ sort: 'head'})}>Head</th>\n          <th onClick={() => props.sortBySignal({ sort: 'pd'})}>P(D)</th>\n          <th onClick={() => props.sortBySignal({ sort: 'pd_0'})}>P(D|0T)</th>\n          <th onClick={() => props.sortBySignal({ sort: 'pd_1'})}>P(D|1T)</th>\n          <th onClick={() => props.sortBySignal({ sort: 'pd_2'})}>P(D|2T)</th>\n          <th onClick={() => props.sortBySignal({ sort: 'pd_3'})}>P(D|3T)</th>\n          <th onClick={() => props.sortBySignal({ sort: 'pd_4'})}>P(D|4T)</th>\n          <th onClick={() => props.sortBySignal({ sort: 'pd_5'})}>P(D|5T)</th>\n          <th onClick={() => props.sortBySignal({ sort: 'pd_6'})}>P(D|6+)</th>\n        </tr>\n      { \n        _.map(all_groups, (g,i) => {\n          let perc = 0;\n          if (g.dead && g.head) perc = g.dead.length / g.head;\n          let name = g.groupname;\n          if (name.length > 15) name = name.slice(0,6)+'...'+name.slice(-6);\n          return (\n            <tr className={ perc < .05 ? 'historygroupgood' : perc < 0.1 ? 'historygroupmeh' : 'historygroupbad' } key={'historygrouprow'+i}>\n              <td className=\"historygroupname\"><span name=\"historygroupnamepill\">{ name }</span></td>\n              <td className=\"historygroupdate\"> { moment(g.date,'YYYY-MM-DD').format('M/DD/YY') }</td>\n              <td className=\"historygroupdead\">{ g.dead ? g.dead.length : 0 }</td>\n              <td className=\"historygroupperc\">{ perc > 0 ? '('+numeral(perc).format('0.00%')+')' : '' }</td>\n            </tr>\n          );\n        })\n      }\n      </tbody>\n      </table>\n    </div>\n  );\n});\n\n","import React from 'react';\nimport _ from 'lodash';\nimport numeral from 'numeral';\nimport { extendMoment } from 'moment-range';\nimport Moment from 'moment';\n\nimport {connect} from '@cerebral/react';\nimport {state} from 'cerebral/tags';\n\nconst moment = extendMoment(Moment);\n\nexport default connect({\n  historySelector: state`historySelector`,\n      deadRecords: state`dead.records`,\n           record: state`record`,\n}, function HistoryTime(props) {\n\n  const today = moment();\n  const lastmonth = moment.range(today.clone().subtract(1,'months'),today);\n  const lastthreemonths = moment.range(today.clone().subtract(3,'months'),today);\n  const lastyear = moment.range(today.clone().subtract(1,'years'),today);\n\n  const deadlastmonth       = _.filter(props.deadRecords, r => moment(r.date,'YYYY-MM-DD').within(lastmonth));\n  const deadlastthreemonths = _.filter(props.deadRecords, r => moment(r.date,'YYYY-MM-DD').within(lastthreemonths));\n  const deadlastyear        = _.filter(props.deadRecords, r => moment(r.date,'YYYY-MM-DD').within(lastyear));\n\n  const totallastmonth       = _.reduce(deadlastmonth,       (sum,r) => sum+r.tags.length, 0);\n  const totallastthreemonths = _.reduce(deadlastthreemonths, (sum,r) => sum+r.tags.length, 0);\n  const totallastyear        = _.reduce(deadlastyear,        (sum,r) => sum+r.tags.length, 0);\n  return (\n    <div className=\"historydead\">\n      <div className=\"historydeadentry\">\n        Past month: {totallastmonth} dead ({numeral(totallastmonth/lastmonth.diff('days')).format('0.00')}/day)\n      </div>\n      <div className=\"historydeadentry\">\n        Past 3 months: {totallastthreemonths} dead ({numeral(totallastthreemonths/lastthreemonths.diff('days')).format('0.00')}/day)\n      </div>\n      <div className=\"historydeadentry\">\n        Past year: {totallastyear} dead ({numeral(totallastyear/lastyear.diff('days')).format('0.00')}/day)\n      </div>\n    </div>\n  );\n});\n\n","import React from 'react';\nimport { connect } from '@cerebral/react';\nimport { sequences } from 'cerebral/tags';\n\nimport './Prefs.css';\n\nimport { version } from '../package.json';\n\nexport default connect({\n  logout: sequences`logout`,\n}, function Prefs(props) {\n\n  const logoutClicked = evt => {\n    props.logout();\n    evt.preventDefault();\n  }\n\n  return (\n    <div className=\"prefs\">\n      <p className=\"prefslink\" href=\"#\" onClick={logoutClicked}>Change Trello Account</p>\n      <p className=\"prefsinfo\">Treatments App Version 1.0.0</p>\n    </div>\n  );\n});\n\n","import React from 'react';\n\nimport {connect} from '@cerebral/react';\nimport {state} from 'cerebral/tags';\n\nimport  HistoryDate from './HistoryDate';\nimport   HistoryTag from './HistoryTag';\nimport HistoryGroup from './HistoryGroup';\nimport  HistoryTime from './HistoryTime';\nimport        Prefs from './Prefs';\n\nimport './History.css';\n\nexport default connect({\n   historySelector: state`historySelector`,\n}, function History(props) {\n  let ret = (<div className='history'>Unknown History Type</div>);\n  switch(props.historySelector.active) {\n    case  'date': ret = <HistoryDate />;  break;\n    case   'tag': ret = <HistoryTag />;   break;\n    case 'group': ret = <HistoryGroup />; break;\n    case  'time': ret = <HistoryTime />;  break;\n    case 'prefs': ret = <Prefs />;  break;\n    default:\n  }\n  return ret;\n});\n\n","import React from 'react';\nimport FontAwesome from 'react-fontawesome';\n\nimport {connect} from '@cerebral/react';\nimport {state,sequences} from 'cerebral/tags';\n\nimport './HistorySelector.css';\n\nexport default connect({\n  historySelector: state`historySelector`,\n  historySelectionChangeRequested: sequences`historySelectionChangeRequested`,\n}, function HistorySelector(props) {\n  const prefsClicked = evt => props.historySelectionChangeRequested({ active: 'prefs' });\n  const  dateClicked = evt => props.historySelectionChangeRequested({ active: 'date' });\n  const   tagClicked = evt => props.historySelectionChangeRequested({ active: 'tag' });\n  const groupClicked = evt => props.historySelectionChangeRequested({ active: 'group' });\n  const  timeClicked = evt => props.historySelectionChangeRequested({ active: 'time' });\n\n  return (\n    <div className=\"historyselector\">\n      <div className={'historyselectorbutton ' + (props.historySelector.active === 'prefs' ? 'historyselectorbuttonactive' : '')}\n           onClick={prefsClicked}>\n        <FontAwesome name='bars' />\n      </div>\n      <div className={'historyselectorbutton ' + (props.historySelector.active === 'date' ? 'historyselectorbuttonactive' : '')}\n           onClick={dateClicked}>\n        Date\n      </div>\n      <div className={'historyselectorbutton ' + (props.historySelector.active === 'tag' ? 'historyselectorbuttonactive' : '')}\n           onClick={tagClicked}>\n        Tag\n      </div>\n      <div className={'historyselectorbutton ' + (props.historySelector.active === 'group' ? 'historyselectorbuttonactive' : '')}\n           onClick={groupClicked}>\n        Group\n      </div>\n      <div className={'historyselectorbutton ' + (props.historySelector.active === 'time' ? 'historyselectorbuttonactive' : '')}\n           onClick={timeClicked}>\n        Time\n      </div>\n\n    </div>\n  );\n\n});\n\n","import React from 'react';\n\nimport {connect} from '@cerebral/react';\nimport {state} from 'cerebral/tags';\n\nimport TagBar from './TagBar';\nimport Msg from './Msg';\nimport History from './History';\nimport HistorySelector from './HistorySelector';\n\nimport './TagPane.css';\n\nexport default connect({\n  windowSize: state`windowSize`,\n  historySelector: state`historySelector`,\n}, function TagPane(props) {\n  let maxHeight = '98vh';\n  const active = props.historySelector.active;\n  if (props.windowSize.orientation === 'portrait' && active !== 'group' && active !== 'time') {\n    maxHeight = '49vh';\n  }\n  return (\n    <div className='tagpane' style={{ maxHeight }}> \n      <TagBar />\n      <Msg />\n      <HistorySelector />\n      <History />\n    </div>\n   );\n});\n","import React from 'react';\nimport _ from 'lodash';\n\nimport {connect} from '@cerebral/react';\n\nimport './Keypad.css';\n\nexport default connect({\n}, class Keypad extends React.Component {\n\n  keypressed(evt) {\n    if (evt.keyCode === 8) {\n      this.props.onBackspace(); // backspace\n      evt.preventDefault();\n    }\n    const number = evt.keyCode - 48; // 0 is key 48\n    if (number >= 0 && number <=9) {\n      this.props.onNumber(number);\n      evt.preventDefault();\n    }\n  }\n  componentDidMount() {\n    document.addEventListener('keypress', this.keypressed.bind(this));\n  }\n  componentWillUnmount() {\n    document.removeEventListener('keypress', this.keypressed.bind(this));\n  }\n\n  numberClicked(n) {\n    return (evt) => {\n      evt.preventDefault();\n      this.props.onNumber(n);\n    }\n  }\n\n  clearClicked(evt) {\n    evt.preventDefault();\n    this.props.onClear();\n  }\n\n  backspaceClicked(evt) {\n    evt.preventDefault();\n    this.props.onBackspace();\n  }\n\n  renderCalcRow(arr) {\n    return (\n      <div className=\"keypadrow\"> \n        {\n          arr.map(info => \n              <div className=\"keypadbutton\"\n                   key={'calcwrap'+(_.isObject(info) ? info.val : info)}\n                   onClick={_.isObject(info) ? info.clicked : this.numberClicked(info).bind(this) }>\n                {_.isObject(info) ? info.val : info}\n              </div>\n          )\n        }\n      </div>\n    );\n  }\n\n  render() {\n    return (\n      <div className=\"keypad\">\n        {this.renderCalcRow([1,2,3])}\n        {this.renderCalcRow([4,5,6])}\n        {this.renderCalcRow([7,8,9])}\n        { \n          this.renderCalcRow([\n            { val: 'C', clicked: this.clearClicked.bind(this) },\n            0,\n            { val: '<--', clicked: this.backspaceClicked.bind(this) },\n          ])\n        }\n      </div>\n    );\n  }\n});\n\n\n","import React from 'react';\nimport _ from 'lodash';\n\nimport {connect} from '@cerebral/react';\nimport {state,sequences} from 'cerebral/tags';\n\nimport './Colorbar.css';\n\nexport default connect({\n  record: state`record`,\n  colors: state`treatments.colors`,\n  changeRecord: sequences`changeRecord`,\n}, class Colorbar extends React.Component {\n\n  keypressed(evt) {\n    let color = '';\n    switch(evt.key) {\n      case 'y': color = 'YELLOW'; break;\n      case 'g': color = 'GREEN'; break;\n      case 'b': color = 'BLUE'; break;\n      case 'r': color = 'RED'; break;\n      case 'p': color = 'PURPLE'; break;\n      case 'w': color = 'WHITE'; break;\n      case 'n': color = 'NOTAG'; break;\n      default: return;\n    }\n    evt.preventDefault();\n    this.props.changeRecord({tag: { color: color } });\n  }\n  componentDidMount() {\n    document.addEventListener('keypress', this.keypressed.bind(this));\n  }\n  componentWillUnmount() {\n    document.removeEventListener('keypress', this.keypressed.bind(this));\n  }\n\n  colorButtonClicked(color) { \n    const props = this.props;\n    return evt => {\n      evt.preventDefault();\n      props.changeRecord({tag: { color: color } });\n    };\n  }\n\n  render() {\n    return (\n      <div className=\"colorbar\">\n        {_.keys(this.props.colors).map((c,k) => \n            <div key={'color'+c} \n                 className=\"colorbutton\"\n                 onClick={this.colorButtonClicked(c)} \n                 style={{backgroundColor: this.props.colors[c] }}>\n            </div>\n         )}\n         <div key={'colorNOTAG'}\n              className=\"colorbutton\"\n              onClick={this.colorButtonClicked('NOTAG')}\n              style={{backgroundColor: '#CCCCCC'}}>\n          N\n        </div>\n      </div>\n    );\n  }\n\n});\n\n","import React from 'react';\n\nimport {connect} from '@cerebral/react';\nimport {state,sequences} from 'cerebral/tags';\n\nimport './TreatmentDateBar.css';\n\nexport default connect({\n          record: state`record`,\n  treatmentCodes: state`treatments.treatmentCodes`,\n         changeRecord: sequences`changeRecord`,\n  showTreatmentEditor: sequences`showTreatmentEditor`,\n}, function TreatmentDateBar(props) {\n\n  const dateChanged = evt => {\n    evt.preventDefault();\n    props.changeRecord({date: evt.target.value});\n  };\n\n  const treatmentTextClicked = evt => {\n    evt.preventDefault();\n    props.showTreatmentEditor();\n  };\n\n  return (\n    <div className=\"treatmentdatebar\">\n      <input className='treatmentdateinput'\n             value={props.record.date}\n             type=\"date\"\n             onChange={dateChanged} />\n      <input className='treatmentstring'\n             value={props.record.treatment}\n             type=\"text\"\n             onClick={treatmentTextClicked}\n             onChange={treatmentTextClicked}/>\n    </div>\n  );\n});\n","import React from 'react';\n\nimport {connect} from '@cerebral/react';\nimport {state,sequences} from 'cerebral/tags';\n\nimport Keypad from './Keypad.js';\nimport Colorbar from './Colorbar.js';\nimport TreatmentDateBar from './TreatmentDateBar.js';\n\nimport './RecordInput.css';\n\nexport default connect({\n          record: state`record`,\n          colors: state`colors`,\n  treatmentCodes: state`treatments.treatmentCodes`,\n    recordsValid: state`recordsValid`,\n       changeRecord: sequences`changeRecord`,\n         saveRecord: sequences`saveRecord`,\n}, function RecordInput(props) {\n\n  const numberClicked = num => {\n    const prefix = '' + (props.record.tag.number || ''); // convert to string\n    props.changeRecord({tag: { number: prefix+num} });\n  };\n\n  const clearClicked = () => {\n    props.changeRecord({ tag: { number: '', color: '' } });\n  };\n\n  const backspaceClicked = () => {\n    let str = ''+props.record.tag.number;\n    if (str.length > 0) str = str.slice(0,-1);\n    props.changeRecord({ tag: { number: +(str) } });\n  };\n\n  const canSave = props.recordsValid && props.record.tag && props.record.tag.number && props.record.tag.color;\n\n  const recordSaveClicked = evt => {\n    if (canSave) {\n      evt.preventDefault();\n      props.saveRecord();\n    }\n  };\n\n  return (\n    <div className=\"recordinput\">\n\n      <Colorbar />\n\n      <TreatmentDateBar />\n\n      <Keypad onNumber={numberClicked}\n              onClear={clearClicked}\n              onBackspace={backspaceClicked} />\n\n      <div className={'savebutton ' + (canSave ? 'savebuttonenabled':'savebuttondisabled')}\n           onClick={recordSaveClicked}>\n        SAVE TREATMENT\n      </div>\n\n    </div>\n  );\n});\n","import React from 'react';\nimport _ from 'lodash';\n\nimport {connect} from '@cerebral/react';\nimport {sequences,state} from 'cerebral/tags';\n\nimport './TreatmentEditor.css';\n\nexport default connect({\n            record: state`record`,\n    treatmentCodes: state`treatments.treatmentCodes`,\n  treatmentRecords: state`treatments.records`,\n         changeRecord: sequences`changeRecord`,\n  hideTreatmentEditor: sequences`hideTreatmentEditor`,\n}, function TreatmentEditor(props) {\n  const treatmentTextChanged = evt => {\n    evt.preventDefault();\n    props.changeRecord({ treatment: evt.target.value() });\n  };\n\n\n  const codelistFromText = text => {\n    let tokens = text.match(/([A-Z]([a-z]+)?)/g); // [ 'Z', 'Za', etc]\n    if (!tokens) tokens = [];\n    return _.map(props.treatmentCodes, c => {\n      return {\n        code: c.code,\n        name: c.name,\n        on: !!_.find(tokens,t=>c.code===t),\n      };\n    });\n  };\n  const textFromCodelist = list => _.join(_.map(_.filter(list,c=>c.on),c=>c.code),'');\n  const treatmentCodeButtonClicked = code => evt => {\n    // turn on/off this code in the list\n    const list = codelistFromText(props.record.treatment);\n    const thiscode = _.findIndex(list,c=>c.code===code);\n    if (thiscode<0) return;\n    list[thiscode].on = !list[thiscode].on;\n    props.changeRecord({ treatment: textFromCodelist(list) });\n  };\n\n  const recentCodesFromRecords = () => {\n    const sorted = _.reverse(_.sortBy(props.treatmentRecords,[ r => r.date, r => r.dateLastActivity ]));\n    return _.reduce(sorted,(acc,r) => {\n      if (acc.length >= 5) return acc; // only get 5 most recent\n      if (_.includes(acc,r.treatment)) return acc;\n      acc.push(r.treatment);\n      return acc;\n    },[]);\n  }\n  const recentTreatmentClicked = t => evt => props.changeRecord({treatment: t});\n\n  const treatmentEditorDoneClicked = evt => props.hideTreatmentEditor();\n  const codesOn = _.keyBy(codelistFromText(props.record.treatment),c=>c.code);\n  const recent = recentCodesFromRecords();\n  return (\n    <div className='treatmentEditor'>\n      \n      <input className='treatmentEditorTextInput'\n             type='text'\n             value={props.record.treatment}\n             onChange={treatmentTextChanged} />\n\n      <div className='treatmentCodesList'>\n        {_.map(props.treatmentCodes, (c,i) => \n          <div className={'treatmentCodeButton ' + (codesOn[c.code].on ? 'codeOn' : 'codeOff')}\n               key={'treatmentCodeButton'+i}\n               onClick={treatmentCodeButtonClicked(c.code)}>\n            <div className='treatmentCodeButtonCode'>\n              {c.code}\n            </div>\n            <div className='treatmentCodeButtonName'>\n              {c.name}\n            </div>\n          </div>\n        )}\n      </div>\n\n      <div className='recentTreatmentsList'>\n        <div className='recentText'>Recent: </div>\n        {_.map(recent, (t,i) =>\n          <div className='recentTreatmentsButton'\n               key={'recentTreatments'+i}\n               onClick={recentTreatmentClicked(t)}>\n            {t}\n          </div>\n        )}\n      </div>\n\n      <div className='treatmentEditorDoneButton'\n           onClick={treatmentEditorDoneClicked}>\n        Done\n      </div>\n\n    </div>\n  );\n\n});\n","import React from 'react';\nimport {connect} from '@cerebral/react';\nimport {state,sequences} from 'cerebral/tags';\n\nimport TagPane from './TagPane';\nimport RecordInput from './RecordInput';\nimport TreatmentEditor from './TreatmentEditor';\n\nimport './App.css';\n\nexport default connect({\n  treatmentEditorActive: state`treatmentEditorActive`,\n             windowSize: state`windowSize`,\n                 trello: state`trello`,\n        historySelector: state`historySelector`,\n  init: sequences`init`,\n}, class App extends React.Component {\n\n  componentDidMount() {\n    this.props.init();\n  }\n\n  render() {\n    const dir = this.props.windowSize.orientation === 'landscape' ? 'row' : 'column';\n    const active = this.props.historySelector.active;\n\n    if (this.props.treatmentEditorActive) {\n      return (\n        <div className=\"App\" style={{ flexDirection: 'column' }} >\n          <TreatmentEditor />\n        </div>\n      );\n    }\n    return (\n      <div className=\"App\" style={{ flexDirection: dir }}>\n        <TagPane />\n        {active === 'group' || active === 'time' ? '' : \n          <RecordInput />\n        }\n      </div>\n    );\n  }\n\n});\n","import _classCallCheck from \"/Users/aultac/repos/aultfarms/treatments/apps/treatments/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _possibleConstructorReturn from \"/Users/aultac/repos/aultfarms/treatments/apps/treatments/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/aultac/repos/aultfarms/treatments/apps/treatments/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/aultac/repos/aultfarms/treatments/apps/treatments/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport { CerebralError } from 'cerebral';\nexport var TrelloSaveError =\n/*#__PURE__*/\nfunction (_CerebralError) {\n  _inherits(TrelloSaveError, _CerebralError);\n\n  function TrelloSaveError() {\n    _classCallCheck(this, TrelloSaveError);\n\n    return _possibleConstructorReturn(this, _getPrototypeOf(TrelloSaveError).apply(this, arguments));\n  }\n\n  return TrelloSaveError;\n}(CerebralError);\n;\nexport var TrelloGetError =\n/*#__PURE__*/\nfunction (_CerebralError2) {\n  _inherits(TrelloGetError, _CerebralError2);\n\n  function TrelloGetError() {\n    _classCallCheck(this, TrelloGetError);\n\n    return _possibleConstructorReturn(this, _getPrototypeOf(TrelloGetError).apply(this, arguments));\n  }\n\n  return TrelloGetError;\n}(CerebralError);\n;\nexport var TrelloAuthorizeError =\n/*#__PURE__*/\nfunction (_CerebralError3) {\n  _inherits(TrelloAuthorizeError, _CerebralError3);\n\n  function TrelloAuthorizeError() {\n    _classCallCheck(this, TrelloAuthorizeError);\n\n    return _possibleConstructorReturn(this, _getPrototypeOf(TrelloAuthorizeError).apply(this, arguments));\n  }\n\n  return TrelloAuthorizeError;\n}(CerebralError);\n;","import _taggedTemplateLiteral from \"/Users/aultac/repos/aultfarms/treatments/apps/treatments/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\n\nfunction _templateObject5() {\n  var data = _taggedTemplateLiteral([\"\", \"\"]);\n\n  _templateObject5 = function _templateObject5() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject4() {\n  var data = _taggedTemplateLiteral([\"trello.lists\"]);\n\n  _templateObject4 = function _templateObject4() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject3() {\n  var data = _taggedTemplateLiteral([\"trello.lists.\", \"\"]);\n\n  _templateObject3 = function _templateObject3() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"trello.authorized\"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"trello.authorized\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport _ from 'lodash';\nimport { state, sequence, CerebralError } from 'cerebral';\nimport { set } from 'cerebral/factories';\nimport Promise from 'bluebird';\nimport * as errors from './errors';\nvar CARD_FIELDS = 'name,id,closed,desc,dateLastActivity,labels,idList'; // For some reason cerebral seems to trigger these dumb warnings\n\nPromise.config({\n  // Enables all warnings except forgotten return statements.\n  warnings: {\n    wForgottenReturn: false\n  }\n}); //-----------------------------------------------\n// authorize and deauthorize\n\nexport var authorize = [function (_ref) {\n  var trello = _ref.trello;\n  return trello.authorize().catch(function (e) {\n    e.message = 'Failed to authorize trello: ' + e.message + JSON.stringify(e.stack);\n    throw new errors.TrelloAuthorizeError(e);\n  });\n}, set(state(_templateObject()), true)];\nexport var deauthorize = [set(state(_templateObject2()), false), sequence('deauthorize->authorize', authorize)]; //-----------------------------------------------------------\n// loadList sequence: given a board and list name in props, \n// load it into the state from Trello\n// props = { boardName, listName, key } the list's data will be put at trello.lists.<key>\n// We will keep a promise for each board/list that we need to verify exists\n// in order to prevent simulataneous accesses from creating duplicate boards/lists\n// when they see that a board doesn't exist yet.\n\nvar initialized = {\n  boards: {},\n  lists: {}\n};\nexport var loadList = sequence('trello.loadList', [function (_ref2) {\n  var props = _ref2.props,\n      trello = _ref2.trello;\n  var ret = {}; // First get the board\n\n  return Promise.try(function () {\n    if (initialized.boards[props.boardName]) return initialized.boards[props.boardName]; // if this is a promise, then someone else is initializing or it's done already\n    // Start by getting board, create if doesn't exist, save promise in \"initialized\":\n\n    return initialized.boards[props.boardName] = trello.get('members/me/boards', {\n      fields: 'name,id,closed'\n    }).filter(function (b) {\n      return b && !b.closed;\n    }).then(function (result) {\n      var board = _.find(result, function (b) {\n        return b.name === props.boardName;\n      });\n\n      if (board) return board;\n      console.log('Could not find board ' + props.boardName + ', creating it.');\n      return trello.post('boards', {\n        name: props.boardName\n      }); // the result of this call is the board object itself\n    });\n  }).then(function (board) {\n    ret.board = board;\n  }) // Then get the labels:\n  .then(function () {\n    return trello.get(\"boards/\".concat(ret.board.id, \"/labels\"), {\n      fields: 'id,name,color'\n    });\n  }).then(function (labels) {\n    ret.labels = labels;\n  }) // Then get the list info:\n  .then(function () {\n    if (initialized.lists[props.listName]) return initialized.lists[props.listName];\n    return initialized.lists[props.listName] = trello.get(\"boards/\".concat(ret.board.id, \"/lists\"), {\n      fields: 'name,id,closed,cards'\n    }).filter(function (l) {\n      return l && !l.closed;\n    }).then(function (result) {\n      var list = _.find(result, function (l) {\n        return l.name === props.listName;\n      });\n\n      if (list) return list;\n      console.log('Could not find list ' + props.listName + ', creating it.');\n      return trello.post(\"boards/\".concat(ret.board.id, \"/lists\"), {\n        name: props.listName\n      }); // resolves to the list object itself\n    });\n  }).then(function (list) {\n    ret.list = list;\n  }) // Now setup the final return statement and catch:\n  .then(function () {\n    return ret;\n  }).catch(function (error) {\n    error.message = 'Failed to get list ' + props.listName + ': ' + error.message;\n    throw new errors.TrelloGetError(error);\n  });\n}, // Now get the cards for this list:\nfunction (_ref3) {\n  var props = _ref3.props,\n      trello = _ref3.trello;\n  return trello.get('lists/' + props.list.id + '/cards', {\n    fields: CARD_FIELDS\n  }).filter(function (c) {\n    return c && !c.closed;\n  }) // Save the state path for this card inside the card itself so we can easily update later\n  .then(function (cards) {\n    return _.keyBy(_.map(cards, function (c) {\n      c.statePath = \"trello.lists.\".concat(props.key, \".\").concat(c.id);\n      return c;\n    }), function (c) {\n      return c.id;\n    });\n  }).then(function (result) {\n    return {\n      cards: result\n    };\n  }).catch(function (error) {\n    error.message = 'Failed to get cards for list ' + props.listName + ': ' + error.message;\n    throw new errors.TrelloGetError(error);\n  });\n}, // Put everything into state:\nfunction (_ref4) {\n  var props = _ref4.props,\n      store = _ref4.store,\n      get = _ref4.get;\n  store.set(state(_templateObject3(), props.key), {\n    id: props.list.id,\n    name: props.list.name,\n    cards: props.cards,\n    board: props.board,\n    labels: props.labels\n  });\n}]); // All this does is refresh the card object in-place.  It does not check that\n// it is still in the same board.\n\nexport var reloadOneCard = sequence('trello.reloadOneCard', [function (_ref5) {\n  var trello = _ref5.trello,\n      props = _ref5.props,\n      store = _ref5.store,\n      get = _ref5.get;\n  if (!props.card || !props.card.id) return;\n  return trello.get(\"cards/\".concat(props.card.id), {\n    fields: CARD_FIELDS\n  }).then(function (card) {\n    // Find the original place in Trello part of the state:\n    var lists = get(state(_templateObject4()));\n\n    var list = _.find(lists, function (list, listname) {\n      return list.id === card.idList;\n    });\n\n    var statePath = \"trello.lists.\".concat(list.name.toLowerCase(), \".cards.\").concat(card.id); // Now change it in the state:\n\n    card.statePath = statePath;\n    store.set(state(_templateObject5(), statePath), card);\n    return {\n      card: card\n    };\n  });\n}]); // props.card = {\n//   id: 'only use if this card already exists',\n//   name: 'the name to put',\n//   idList: 'id of list for card, required no matter what',\n// }\n\nexport var putCard = sequence('trello.putCard', [function (_ref6) {\n  var trello = _ref6.trello,\n      props = _ref6.props;\n  return Promise.try(function () {\n    var url = 'cards/';\n\n    if (!props.card.id) {\n      // card does not exist, do a post\n      return trello.post(url, {\n        name: props.card.name,\n        idList: props.card.idList\n      });\n    }\n\n    url += props.card.id + '/'; // card already exists, do a put to that card\n\n    return trello.put(url, {\n      name: props.card.name,\n      idList: props.card.idList\n    });\n  }).catch(function (err) {\n    throw new errors.TrelloSaveError('Failed to save to card', err);\n  });\n}, reloadOneCard]); // props.id, props.idLabel\n\nexport var addLabelToCard = sequence('trello.addLabelToCard', [function (_ref7) {\n  var trello = _ref7.trello,\n      props = _ref7.props;\n  trello.post(\"cards/\".concat(props.card.id, \"/idLabels\"), {\n    value: props.idLabel\n  });\n}, // Get the board name that goes with this card\nreloadOneCard]);","import _taggedTemplateLiteral from \"/Users/aultac/repos/aultfarms/treatments/apps/treatments/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\n\nfunction _templateObject8() {\n  var data = _taggedTemplateLiteral([\"treatments.treatmentCodes\"]);\n\n  _templateObject8 = function _templateObject8() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject7() {\n  var data = _taggedTemplateLiteral([\"treatments.colors\"]);\n\n  _templateObject7 = function _templateObject7() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject6() {\n  var data = _taggedTemplateLiteral([\"treatments.tagIndex\"]);\n\n  _templateObject6 = function _templateObject6() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject5() {\n  var data = _taggedTemplateLiteral([\"treatments.records\"]);\n\n  _templateObject5 = function _templateObject5() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject4() {\n  var data = _taggedTemplateLiteral([\"incoming.records\"]);\n\n  _templateObject4 = function _templateObject4() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject3() {\n  var data = _taggedTemplateLiteral([\"treatments.records\"]);\n\n  _templateObject3 = function _templateObject3() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"trello.lists.treatments.id\"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"treatments.records\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport moment from 'moment';\nimport _ from 'lodash';\nimport { set } from 'cerebral/operators';\nimport { state, sequence, CerebralError } from 'cerebral';\nimport { tagStrToObj, tagObjToStr, groupForTag } from '../../util/tagHelpers';\nimport * as trello from '../../trello/module/sequences'; //---------------------------------------------------------------\n// save one treatment\n\nexport var saveTreatment = [// find existing card that matches this date and treatment (if it exists):\nfunction (_ref) {\n  var props = _ref.props,\n      store = _ref.store,\n      get = _ref.get;\n  var ret = false;\n  var records = get(state(_templateObject()));\n\n  var existing = _.find(records, function (r) {\n    return r.date === props.record.date && r.treatment === props.record.treatment;\n  });\n\n  if (!existing) {\n    ret = _.cloneDeep(props.record);\n    ret.tags = [ret.tag];\n    return {\n      record: ret\n    }; // existing record is fine as-is in props, just needed array of tags instead of just one\n  } // Otherwise, check if this tag is already in the list:\n\n\n  var alreadyInList = _.find(existing.tags, function (t) {\n    return props.record.tag.color === t.color && props.record.tag.number === t.number;\n  });\n\n  if (alreadyInList) return {\n    record: existing\n  }; // replace record in props with existing record\n  // Otherwise, add record to the list of existing tags since it's not already there\n\n  ret = _.cloneDeep(existing);\n  ret.tags.push(props.record.tag); // replace record in props with this new one:\n\n  return {\n    record: ret\n  };\n}, // convert record to card\nfunction (_ref2) {\n  var props = _ref2.props,\n      store = _ref2.store,\n      get = _ref2.get;\n  return {\n    card: {\n      id: props.record.id,\n      idList: props.record.idList || get(state(_templateObject2())),\n      name: props.record.date + ': ' + props.record.treatment + ': ' + _.join(_.map(props.record.tags, function (t) {\n        return t.color + t.number;\n      }), ' ')\n    }\n  };\n}, // Put the card to trello:\ntrello.putCard]; //---------------------------------------------------------------------\n// fetch all treatment records:\n\nvar treatmentCardToRecord = function treatmentCardToRecord(c) {\n  if (!c) return null;\n  var name = c.name;\n  var datematches = name.match(/^([0-9]{4}-[0-9]{2}-[0-9]{2}):(.*)$/);\n  if (!datematches || datematches.length < 3) return null;\n  var date = datematches[1].trim();\n  var rest = datematches[2].trim();\n  var treatmentmatches = rest.match(/^(.+):(.*)$/);\n  if (!treatmentmatches || treatmentmatches.length < 3) return null;\n  var treatment = treatmentmatches[1].trim();\n  rest = treatmentmatches[2].trim();\n\n  var tags = _.map(_.split(rest, ' '), tagStrToObj);\n\n  return {\n    date: date,\n    treatment: treatment,\n    tags: tags,\n    id: c.id,\n    idList: c.idList,\n    cardName: c.name,\n    dateLastActivity: c.dateLastActivity\n  };\n};\n\nexport var fetch = sequence('treatments.fetch', [// get the cards\nfunction () {\n  return {\n    boardName: 'Livestock',\n    listName: 'Treatments',\n    key: 'treatments'\n  };\n}, trello.loadList, // convert all props.cards to records:\nfunction (_ref3) {\n  var props = _ref3.props,\n      store = _ref3.store;\n  return store.set(state(_templateObject3()), _.map(props.cards, treatmentCardToRecord));\n}, // compute the tagIndex as { <tag>: { <groupname>: { group: {}, treatments: [ ] } }\nfunction (_ref4) {\n  var props = _ref4.props,\n      get = _ref4.get,\n      store = _ref4.store;\n  var incoming = get(state(_templateObject4()));\n  var records = get(state(_templateObject5()));\n\n  var tagIndex = _.reduce(records, function (acc, r) {\n    if (!r.tags) return acc;\n\n    _.each(r.tags, function (t) {\n      var str = tagObjToStr(t);\n      var g = groupForTag(incoming, t, r.date);\n      if (!g) g = {\n        groupname: \"NONE\"\n      }; // early tags have no group\n\n      if (!acc[str]) acc[str] = {};\n      if (!acc[str][g.groupname]) acc[str][g.groupname] = {\n        group: g,\n        treatments: []\n      };\n      acc[str][g.groupname].treatments.push({\n        date: r.date,\n        treatment: r.treatment\n      });\n    });\n\n    return acc;\n  }, {});\n\n  store.set(state(_templateObject6()), tagIndex);\n}]); //---------------------------------------------------------------------\n// fetch the config cards (colors, treatmentCodes)\n\nvar colorsCardToRecord = function colorsCardToRecord(c) {\n  return c ? JSON.parse(c.desc) : null;\n};\n\nvar codesCardToRecord = function codesCardToRecord(c) {\n  return c ? JSON.parse(c.desc) : null;\n};\n\nexport var fetchConfig = sequence('treatments.fetchConfig', [function () {\n  return {\n    boardName: 'Livestock',\n    listName: 'Config',\n    key: 'livestockConfig'\n  };\n}, // get the colors and codes cards:\ntrello.loadList, // save colors in state:\nsequence('saveColors', [function (_ref5) {\n  var props = _ref5.props,\n      store = _ref5.store;\n  return store.set(state(_templateObject7()), colorsCardToRecord(_.find(props.cards, function (c) {\n    return c.name === 'Tag Colors';\n  })));\n}]), // save treatment codes in state:\nsequence('saveCodes', [function (_ref6) {\n  var props = _ref6.props,\n      store = _ref6.store;\n  return store.set(state(_templateObject8()), codesCardToRecord(_.find(props.cards, function (c) {\n    return c.name === 'Treatment Types';\n  })));\n}])]);","import * as sequences from './sequences';\nexport default {\n  sequences: sequences,\n  state: {\n    treatmentCodes: [{\n      \"code\": \"Z\",\n      \"name\": \"Zuprevo\"\n    }, {\n      \"code\": \"Za\",\n      \"name\": \"Zactran\"\n    }, {\n      \"code\": \"Dr\",\n      \"name\": \"Draxxin\"\n    }, {\n      \"code\": \"N\",\n      \"name\": \"Nuflor\"\n    }, {\n      \"code\": \"No\",\n      \"name\": \"Noromycin\"\n    }, {\n      \"code\": \"P\",\n      \"name\": \"Pennicillin\"\n    }, {\n      \"code\": \"Px\",\n      \"name\": \"Polyflex\"\n    }, {\n      \"code\": \"By\",\n      \"name\": \"Baytril\"\n    }, {\n      \"code\": \"Ex\",\n      \"name\": \"Excenel\"\n    }, {\n      \"code\": \"S\",\n      \"name\": \"Sulfa\"\n    }, {\n      \"code\": \"D\",\n      \"name\": \"Dex\"\n    }, {\n      \"code\": \"E\",\n      \"name\": \"Electrolytes\"\n    }, {\n      \"code\": \"Ht\",\n      \"name\": \"High Temp\"\n    }, {\n      \"code\": \"Lt\",\n      \"name\": \"Low Temp\"\n    }, {\n      \"code\": \"Nt\",\n      \"name\": \"No Temp\"\n    }],\n    colors: {\n      \"ORANGE\": \"#FF9900\",\n      \"YELLOW\": \"#E9E602\",\n      \"MARTYELL\": \"#FF00FF\",\n      \"BLACK\": \"#000000\",\n      \"RED\": \"#FF0000\",\n      \"WHITE\": \"#FFFFFF\"\n    },\n    records: [// {\n      //   date: 2018-03-17,\n      //   treatment: 'DrExHt',\n      //   tags: [\n      //     { number: 123, color: 'ORANGE' }\n      //   ]\n      // },\n    ]\n  }\n};","import _taggedTemplateLiteral from \"/Users/aultac/repos/aultfarms/treatments/apps/treatments/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\nimport _slicedToArray from \"/Users/aultac/repos/aultfarms/treatments/apps/treatments/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nfunction _templateObject4() {\n  var data = _taggedTemplateLiteral([\"incoming.records.\", \".dead\"]);\n\n  _templateObject4 = function _templateObject4() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject3() {\n  var data = _taggedTemplateLiteral([\"incoming.records\"]);\n\n  _templateObject3 = function _templateObject3() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"dead.records\"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"incoming.records\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport _ from 'lodash';\nimport { set } from 'cerebral/factories';\nimport { sequence, state, CerebralError } from 'cerebral';\nimport { tagStrToObj, groupForTag\n/*rangeContainsTag*/\n} from '../../util/tagHelpers';\nimport * as trello from '../../trello/module/sequences'; //---------------------------------------------------------------------\n// fetch all incoming records:\n\nvar incomingCardToRecord = function incomingCardToRecord(c) {\n  if (!c) return null;\n  var name = c.name;\n  var matches = name.match(/^([0-9]{4}-[0-9]{2}-[0-9]{2}):? *([^;]+);(.*)$/);\n  var ret = {};\n  ret.date = matches[1];\n  ret.groupname = matches[2];\n  var rest = matches[3];\n  var parts = rest.split(';');\n\n  _.each(parts, function (p) {\n    var _p$trim$split = p.trim().split(':'),\n        _p$trim$split2 = _slicedToArray(_p$trim$split, 2),\n        propname = _p$trim$split2[0],\n        propval = _p$trim$split2[1];\n\n    ret[propname.toLowerCase().trim()] = propval.trim();\n  }); // If there are tag range(s), parse that out as well\n\n\n  if (ret.tags) {\n    ret.tags = ret.tags.replace(/ /g, ''); // get rid of any spaces\n\n    ret.tag_ranges = _.reduce(ret.tags.split(','), function (acc, r) {\n      // each range turns into 1 or 2 objects depending on color split\n      var _$map = _.map(r.split('-'), tagStrToObj),\n          _$map2 = _slicedToArray(_$map, 2),\n          start = _$map2[0],\n          end = _$map2[1]; // map start and end into objects\n\n\n      if (start.color !== end.color) {\n        acc.push({\n          start: start,\n          end: {\n            color: start.color,\n            number: 1000\n          }\n        });\n        acc.push({\n          start: {\n            color: end.color,\n            number: 1\n          },\n          end: end\n        });\n        return acc;\n      }\n\n      acc.push({\n        start: start,\n        end: end\n      });\n      return acc;\n    }, []);\n  }\n\n  ret.id = c.id;\n  ret.idList = c.idList;\n  ret.cardName = c.name;\n  ret.dateLastActivity = c.dateLastActivity;\n  return ret;\n};\n\nexport var fetch = sequence('incoming.fetch', [function () {\n  return {\n    boardName: 'Livestock',\n    listName: 'Incoming',\n    key: 'incoming'\n  };\n}, // get the cards\ntrello.loadList, // convert all props.cards to records:\nfunction (_ref) {\n  var props = _ref.props,\n      store = _ref.store;\n  return store.set(state(_templateObject()), _.map(props.cards, incomingCardToRecord));\n}]);\nexport var computeStats = sequence('incoming.computeStats', [function (_ref2) {\n  var get = _ref2.get,\n      store = _ref2.store;\n  // check if we have both dead and incoming records:\n  var deadrecords = get(state(_templateObject2()));\n  var incoming = get(state(_templateObject3())); // group all deads into the appropriate incoming group, keyed by groupname\n\n  var groupdeads = _.reduce(deadrecords, function (acc, d) {\n    if (!d.tags) console.log('incoming.computeStats: WARNING: dead record has no tags.  Card name = ', d.cardName);\n\n    _.each(d.tags, function (t) {\n      var g = groupForTag(incoming, t, d.date);\n      if (!g) return; // this is likely an old tag that has no known group, or a notag\n\n      if (!acc[g.groupname]) acc[g.groupname] = [];\n      acc[g.groupname].push({\n        date: d.date,\n        tag: t\n      });\n    });\n\n    return acc;\n  }, {}); // walk through all incoming records and add a \"dead\" key with the list of dead\n\n\n  _.each(incoming, function (g, index) {\n    store.set(state(_templateObject4(), index), groupdeads[g.groupname] || []);\n  });\n}]);","import * as sequences from './sequences';\nexport default {\n  sequences: sequences,\n  state: {\n    records: [// {\n      //   date: 2018-03-17,\n      //   groupname: 'MICH:MAR18-1',\n      //   weight: '274.35',\n      //   head: 250,\n      //   tags: [ \n      //     { \n      //       start: { number: 123, color: 'ORANGE' }, // NOTE: a color split will\n      //       end: { number: 372, color: 'ORANGE' },   // show up as multiple ranges\n      //     },\n      //   ],\n      //   id: 'kf2jlk', // ID of card\n      //   idList: '29ifjkl', // ID of Incoming list in Trello\n      //   cardName: '2018-03-17: MICH:MAR18-1; Head: 250; Weight: 274.35; Tags: ORANGE123-ORANGE372;',\n      // },\n    ]\n  }\n};","import _taggedTemplateLiteral from \"/Users/aultac/repos/aultfarms/treatments/apps/treatments/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\n\nfunction _templateObject13() {\n  var data = _taggedTemplateLiteral([\"trello.lists.dead.id\"]);\n\n  _templateObject13 = function _templateObject13() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject12() {\n  var data = _taggedTemplateLiteral([\"dead.records\"]);\n\n  _templateObject12 = function _templateObject12() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject11() {\n  var data = _taggedTemplateLiteral([\"dead.records\"]);\n\n  _templateObject11 = function _templateObject11() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject10() {\n  var data = _taggedTemplateLiteral([\"dead.tagIndex.\", \"\"]);\n\n  _templateObject10 = function _templateObject10() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject9() {\n  var data = _taggedTemplateLiteral([\"dead.tagIndex.\", \"\"]);\n\n  _templateObject9 = function _templateObject9() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject8() {\n  var data = _taggedTemplateLiteral([\"incoming\"]);\n\n  _templateObject8 = function _templateObject8() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject7() {\n  var data = _taggedTemplateLiteral([\"dead.records\"]);\n\n  _templateObject7 = function _templateObject7() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject6() {\n  var data = _taggedTemplateLiteral([\"dead.records.\", \"\"]);\n\n  _templateObject6 = function _templateObject6() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject5() {\n  var data = _taggedTemplateLiteral([\"dead.records\"]);\n\n  _templateObject5 = function _templateObject5() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject4() {\n  var data = _taggedTemplateLiteral([\"dead.tagIndex\"]);\n\n  _templateObject4 = function _templateObject4() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject3() {\n  var data = _taggedTemplateLiteral([\"incoming.records\"]);\n\n  _templateObject3 = function _templateObject3() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"dead.errors\"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"dead.records\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport moment from 'moment';\nimport _ from 'lodash';\nimport { set } from 'cerebral/factories';\nimport { state, sequence, CerebralError } from 'cerebral';\nimport { tagStrToObj, tagObjToStr, groupForTag } from '../../util/tagHelpers';\nimport * as trello from '../../trello/module/sequences'; //---------------------------------------------------------------------\n// fetch all dead records:\n\nvar deadCardToRecord = function deadCardToRecord(c) {\n  try {\n    if (!c) return null;\n    var name = c.name;\n    var matches = name.match(/^([0-9]{4}-[0-9]{1,2}-[0-9]{1,2}):?(.*)$/);\n    var day = matches[1];\n    var tags_and_pens_str = matches[2]; // Save the note if there is one:\n\n    matches = tags_and_pens_str.match(/[Nn][Oo][Tt][Ee]:(.*)$/);\n    var note = false;\n    if (matches) note = matches[1]; // Ditch anything in parentheses:\n\n    tags_and_pens_str = tags_and_pens_str.replace(/\\(.*\\)/g, '');\n    var tags_and_pens = tags_and_pens_str.match(/([A-Za-z']+ ?([0-9]+)?)/g);\n    tags_and_pens = _.map(tags_and_pens, function (tp) {\n      return tp.trim();\n    });\n    tags_and_pens = _.map(tags_and_pens, function (tp) {\n      return tp === 'NT' ? 'NOTAG1' : tp;\n    }); // eliminate everything that isn't just tags\n\n    var tags = _.filter(tags_and_pens, function (t) {\n      return !t.match(/^[NSB][0-9S]{1,2}$/i) && // N1, NS, S1, B3\n      !t.match(/^OB[SN]?[NS]?$/) && // OBS, OBN, OB, OBNS\n      !t.match(/^HB$/i) && !t.match(/^HEIFER$/i) && !t.match(/^DRY( ?(LOT|COW))?$/i) && !t.match(/^DAIRY$/i) && !t.match(/^APRIL'?S?$/i) && !t.match(/^WOODS$/i) && !t.match(/^BARN ?[1-3]$/i) && !t.match(/^dead/i) && !t.match(/^total/i) && !t.match(/^and/i);\n    }); // fixup bad tags:\n\n\n    tags = _.map(tags, function (t) {\n      return t.toUpperCase().replace(/ /g, '');\n    });\n    tags = _.map(tags, function (t) {\n      return t === 'NOTAG' ? 'NOTAG1' : t;\n    }); // parse all the tag strings into tag objects\n\n    tags = _.map(tags, tagStrToObj);\n    return {\n      date: day,\n      tags: tags,\n      note: note,\n      id: c.id,\n      idList: c.idList,\n      cardName: c.name,\n      dateLastActivity: c.dateLastActivity\n    }; // If anything goes wrong, just put an error record here:\n  } catch (err) {\n    return {\n      cardName: c.name,\n      idList: c.idList,\n      id: c.id,\n      error: err.toString()\n    };\n  }\n};\n\nexport var fetch = sequence('dead.fetch', [function () {\n  return {\n    boardName: 'Livestock',\n    listName: 'Dead',\n    key: 'dead'\n  };\n}, // get the cards\ntrello.loadList, // convert all props.cards to records or errors:\nfunction (_ref) {\n  var props = _ref.props,\n      store = _ref.store,\n      get = _ref.get;\n\n  var _$reduce = _.reduce(props.cards, function (acc, c) {\n    var r = deadCardToRecord(_.cloneDeep(c));\n    if (r.error) acc.errors.push(r);else acc.records.push(r);\n    return acc;\n  }, {\n    errors: [],\n    records: []\n  }),\n      errors = _$reduce.errors,\n      records = _$reduce.records;\n\n  store.set(state(_templateObject()), records);\n  store.set(state(_templateObject2()), errors); // re-index all dead records as { tagstr: { groupname: date } }\n\n  var incoming = get(state(_templateObject3()));\n\n  var tagIndex = _.reduce(records, function (acc, r) {\n    if (!r.tags) return acc;\n\n    _.each(r.tags, function (t) {\n      var str = tagObjToStr(t);\n      var g = groupForTag(incoming, t, r.date);\n      if (!g) g = {\n        groupname: \"NONE\"\n      }; // early tags have no group\n\n      if (!acc[str]) acc[str] = {};\n      acc[str][g.groupname] = r.date;\n    });\n\n    return acc;\n  }, {});\n\n  store.set(state(_templateObject4()), tagIndex);\n}]);\nvar reloadOneRecord = sequence('dead.reloadOneRecord', [function (_ref2) {\n  var props = _ref2.props,\n      store = _ref2.store,\n      get = _ref2.get;\n  // re-process the card into a record, overwrite the previous record.  If it was\n  // a new card, it will get appended to the records list.\n  var records = get(state(_templateObject5()));\n\n  var recordIndex = _.findIndex(records, function (r) {\n    return r.id === props.card.id;\n  });\n\n  var refreshedRecord = deadCardToRecord(props.card);\n\n  if (recordIndex >= 0) {\n    // found it, replace it:\n    store.set(state(_templateObject6(), recordIndex), refreshedRecord);\n  } else {\n    // did not find it, push onto end:\n    store.push(state(_templateObject7()), refreshedRecord);\n  } // Update the tagindex if necessary\n\n\n  var incoming = get(state(_templateObject8()));\n\n  _.each(refreshedRecord.tags, function (t) {\n    var str = tagObjToStr(t);\n    var g = groupForTag(incoming, t, refreshedRecord.date);\n    if (!g) g = {\n      groupname: \"NONE\"\n    }; // early tags have no group\n\n    var previous = _.clone(get(state(_templateObject9(), str)));\n\n    var newone = _.clone(previous) || {};\n    newone[g.groupname] = r.date;\n    store.set(state(_templateObject10(), str), newone);\n  });\n\n  return {\n    record: refreshedRecord\n  };\n}]);\nexport var saveDead = sequence('dead.saveDead', [// Check if this tag is already in any of the days 14 before or after date\n// in order to prevent duplicates:\nfunction (_ref3) {\n  var props = _ref3.props,\n      store = _ref3.store,\n      get = _ref3.get;\n  var records = get(state(_templateObject11()));\n  var start = moment(props.record.date, 'YYYY-MM-DD').subtract(14, 'days');\n  var end = moment(props.record.date, 'YYYY-MM-DD').add(14, 'days');\n\n  var alreadyDead = _.find(records, function (r) {\n    var d = moment(r.date, 'YYYY-MM-DD'); // Not within date range?\n\n    if (!start.isBefore(d) || !end.isAfter(d)) return false; // Tag not already in list?\n\n    if (!_.find(r.tags, function (t) {\n      return t.color === props.record.tag.color && t.number === props.record.tag.number;\n    })) return false; // In date range and tag already in list\n\n    return true;\n  });\n\n  if (alreadyDead) {\n    return {\n      alreadyDead: true\n    };\n  }\n}, // Find existing card for this date if there is one\nfunction (_ref4) {\n  var props = _ref4.props,\n      store = _ref4.store,\n      get = _ref4.get;\n  if (props.alreadyDead) return;\n  var ret = false;\n  var records = get(state(_templateObject12()));\n\n  var existingDate = _.find(records, function (r) {\n    return r.date === props.record.date;\n  }); // If there isn't one, just update record to have \"tags\" as array rather than one tag\n\n\n  if (!existingDate) {\n    ret = _.cloneDeep(props.record);\n    ret.tags = [ret.tag];\n    return {\n      record: ret\n    };\n  } // Otherwise, there is an existing card for this date, add the tag to its list:\n\n\n  ret = _.cloneDeep(existingDate);\n  ret.tags.push(props.record.tag);\n  return {\n    record: ret\n  };\n}, // convert record to card\nfunction (_ref5) {\n  var props = _ref5.props,\n      store = _ref5.store,\n      get = _ref5.get;\n  var card = props.record.card || {};\n  card.id = props.record.id;\n  card.idList = props.record.idList || get(state(_templateObject13())), card.name = props.record.date + ': ' + _.join(_.map(props.record.tags, function (t) {\n    return t.color + t.number;\n  }), ' ') + (props.record.note ? 'Note: ' + props.record.note : '');\n  return {\n    card: card\n  };\n}, // Put the card to Trello, this reloads that one card into state from Trello afterward\ntrello.putCard, // Re-process the card into it's approriate record:\nreloadOneRecord]);","import * as sequences from './sequences';\nexport default {\n  sequences: sequences,\n  state: {\n    tagIndex: {},\n    records: [// {\n      //   date: 2018-03-17,\n      //   tags: [ { number: 123, color: 'ORANGE' }],\n      //   id: '02kjlwfj0f23',                // ID of the card\n      //   idList: '2fj0ijosdf',              // ID of the dead list\n      //   cardName: '2018-03-17: ORANGE123', // original card, for debugging\n      //   dateLastActivity: '2018-03-17',    // for sorting by \"recent\"-ness\n      // },\n    ]\n  }\n};","import * as sequences from './sequences';\nexport default {\n  sequences: sequences,\n  state: {\n    authorized: false,\n    lists: {// feed: {\n      //   name: 'Feed Delivered'\n      //   id: 'kdj20fi32jld',\n      //   cards: { ... },  // the regular trello list of cards\n      // }\n    }\n  }\n};","import _taggedTemplateLiteral from \"/Users/aultac/repos/aultfarms/treatments/apps/treatments/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\n\nfunction _templateObject4() {\n  var data = _taggedTemplateLiteral([\"windowSize.isSmall\"]);\n\n  _templateObject4 = function _templateObject4() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject3() {\n  var data = _taggedTemplateLiteral([\"windowSize.isSmall\"]);\n\n  _templateObject3 = function _templateObject3() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"windowSize.orientation\"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"windowSize.orientation\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport { state, sequence } from 'cerebral';\nexport var resized = sequence('windowSize.resized', [function (_ref) {\n  var windowSize = _ref.windowSize,\n      props = _ref.props,\n      store = _ref.store,\n      get = _ref.get;\n\n  if (get(state(_templateObject())) !== windowSize.orientation()) {\n    store.set(state(_templateObject2()), windowSize.orientation());\n  }\n\n  var isSmall = windowSize.orientation() === 'portrait' ? props.width < 767 : props.height < 500;\n  if (get(state(_templateObject3())) !== isSmall) store.set(state(_templateObject4()), isSmall);\n}]);\nexport var init = sequence('windowSize.init', [function (_ref2) {\n  var windowSize = _ref2.windowSize;\n  return windowSize.init('windowSize.resized');\n}, // registers event listener for window resize events\nresized]);","import * as sequences from './sequences';\nexport default {\n  sequences: sequences,\n  state: {\n    isSmall: true,\n    // changes to true for mobile, false for computer\n    orientation: 'portrait' // portrait | landscape\n\n  }\n};","import _classCallCheck from \"/Users/aultac/repos/aultfarms/treatments/apps/treatments/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _possibleConstructorReturn from \"/Users/aultac/repos/aultfarms/treatments/apps/treatments/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/aultac/repos/aultfarms/treatments/apps/treatments/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/aultac/repos/aultfarms/treatments/apps/treatments/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport { Provider, CerebralError } from 'cerebral';\nimport Promise from 'bluebird';\nexport var TrelloClientLoadError =\n/*#__PURE__*/\nfunction (_CerebralError) {\n  _inherits(TrelloClientLoadError, _CerebralError);\n\n  function TrelloClientLoadError() {\n    _classCallCheck(this, TrelloClientLoadError);\n\n    return _possibleConstructorReturn(this, _getPrototypeOf(TrelloClientLoadError).apply(this, arguments));\n  }\n\n  return TrelloClientLoadError;\n}(CerebralError);\n; // dev key: 3ad06cb25802014a3f24f479e886771c\n// URL to refresh client lib: https://api.trello.com/1/client.js?key=3ad06cb25802014a3f24f479e886771c\n\nvar waitUntilLoaded = function waitUntilLoaded() {\n  return Promise.try(function () {\n    var count = 0;\n\n    var check = function check() {\n      if (window.Trello) return true;\n      if (count++ > 50) throw TrelloClientLoadError('Could not load Trello client library');\n      return Promise.delay(250).then(check);\n    };\n\n    return Promise.try(check);\n  });\n}; // Promisify the normal Trello client:\n\n\nexport default Provider({\n  //-------------------------------------------------\n  // call authorize first before any other functions in this provider:\n  authorize: function authorize() {\n    return waitUntilLoaded().then(function () {\n      return new Promise(function (resolve, reject) {\n        window.Trello.authorize({\n          type: 'redirect',\n          name: 'Ault Farms - Invoices',\n          persist: true,\n          scope: {\n            read: 'true',\n            write: 'true'\n          },\n          expiration: 'never',\n          success: resolve,\n          error: function error(err) {\n            console.log('Failed to authorize Trello: err = ', err);\n            reject(err);\n          }\n        });\n        return null;\n      });\n    });\n  },\n  deauthorize: function deauthorize() {\n    return new Promise(function (resolve, reject) {\n      window.Trello.deauthorize();\n      resolve();\n    });\n  },\n  get: function get(path, params) {\n    return new Promise(function (resolve, reject) {\n      return window.Trello.get(path, params || {}, resolve, function (err) {\n        console.log('Trello.get ERROR: ', err);\n        reject(err);\n      });\n    });\n  },\n  put: function put(path, params) {\n    return new Promise(function (resolve, reject) {\n      return window.Trello.put(path, params, resolve, function (err) {\n        console.log('Trello.put ERROR: ', err);\n        reject(err);\n      });\n    });\n  },\n  post: function post(path, params) {\n    return new Promise(function (resolve, reject) {\n      return window.Trello.post(path, params, resolve, function (err) {\n        console.log('Trello.post ERROR: ', err);\n        reject(err);\n      });\n    });\n  }\n});","import _taggedTemplateLiteral from \"/Users/aultac/repos/aultfarms/treatments/apps/treatments/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\", \"\"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\", \"\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport { sequences } from 'cerebral';\n\nvar _dimensions = function dimensions() {\n  return {\n    width: window.innerWidth,\n    height: window.innerHeight\n  };\n};\n\nvar seq = '';\nvar _M = {\n  dimensions: function dimensions() {\n    return _dimensions();\n  },\n  orientation: function orientation() {\n    var d = _dimensions();\n\n    return d.width > d.height ? 'landscape' : 'portrait';\n  },\n  windowResized: function windowResized() {\n    this.context.get(sequences(_templateObject(), seq))(_dimensions());\n  },\n  init: function init(sequencepath) {\n    seq = sequencepath;\n    window.addEventListener('resize', _M.windowResized.bind(this)); // compute it the first time:\n\n    this.context.get(sequences(_templateObject2(), sequencepath))(_dimensions());\n  }\n};\nexport default _M;","import { set } from 'cerebral/factories';\nimport { state,props } from 'cerebral/tags';\nimport { sequence, parallel } from 'cerebral';\n\nimport * as treatments from 'aultfarms-lib/treatments/module/sequences';\nimport * as incoming   from 'aultfarms-lib/incoming/module/sequences';\nimport * as dead       from 'aultfarms-lib/dead/module/sequences';\nimport * as trello     from 'aultfarms-lib/trello/module/sequences';\nimport * as windowSize from 'aultfarms-lib/windowSize/module/sequences';\n\nexport const updateMsg = sequence('updateMsg', [\n  ({props,get,store}) => {\n    if (props.msg) return state.set('msg', props.msg);\n    if (!get(state`trello.authorized`)) \n      return store.set(state`msg`, { type: 'bad', text: 'You are not logged in to Trello.' });\n    if (get(state`record.is_saved`)) \n      return store.set(state`msg`, { type: 'good', text: 'Treatment record saved.'});\n    store.set(state`msg`, { type: 'bad', text: 'Treatment record not saved'});\n  },\n]);\n\nexport const showTreatmentEditor = sequence('app.showTreatmentEditor', [ \n  set(state`treatmentEditorActive`,true)  \n]);\nexport const hideTreatmentEditor = sequence('app.hideTreatmentEditor', [ \n  set(state`treatmentEditorActive`,false) \n]);\n\nexport const historySelectionChangeRequested = sequence('app.historySelectionChangeRequested', [ \n  set(state`historySelector.active`, props`active`), \n]);\nexport const historyGroupSortClicked = sequence('app.historyGroupSortClicked', [ \n  set(state`historyGroup.sort`, props`sort`) \n]);\n\nexport const changeRecord = sequence('app.changeRecord', [ \n  ({props,store,get}) => {\n    // Only the first time that the is_saved gets set to false, automatically\n    // switch the Date/Tag pane to Tag since we're typing a tag now.\n    if (get(state`record.is_saved`) && !props.date) store.set(state`historySelector.active`, 'tag');\n    // if they are changing a record that has already been saved, go ahead and clear out\n    // the textbox for them\n    if (props.date)                    store.set(state`record.date`, props.date);\n    if (props.treatment)               store.set(state`record.treatment`, props.treatment);\n    if (props.tag && typeof props.tag.color === 'string') {\n      store.set(state`record.tag.color`, props.tag.color);\n      if (props.tag.color === 'NOTAG') store.set(state`record.tag.number`,'1');\n    }\n    if (props.tag && (typeof props.tag.number === 'string' || typeof props.tag.number === 'number')) {\n      store.set(state`record.tag.number`, +(props.tag.number));\n    }\n    if (!props.date) {\n      store.set(state`record.is_saved`, false);\n    }\n  },\n  updateMsg,\n]);\nexport const logout = sequence('app.logout', [ trello.deauthorize, trello.authorize]);\n\nexport const saveRecord = sequence('app.saveRecord', [ \n  set(props`record`, state`record`),\n  set(state`recordsValid`, false),\n  set(state`msg`, { type: 'good', text: 'Saving card...' }),\n  treatments.saveTreatment,\n  set(state`msg`, { type: 'good', text: 'Refreshing records...' }),\n  treatments.fetch,\n  set(state`recordsValid`, true),\n  set(state`record.is_saved`, true),\n  set(state`record.tag.number`, ''),\n  set(state`historySelector.active`, 'date'),\n  updateMsg,\n]);\n\nexport const init = sequence('app.init', [\n  windowSize.init,\n  set(state`msg`, { type: 'good', text: 'Checking trello authorization...' }),\n  trello.authorize,\n  set(state`msg`, { type: 'good', text: 'Fetching records...' }),\n  // dead and treatments need incoming first to compute tagIndex\n  incoming.fetch,\n  parallel('app.init.parallel', [\n    treatments.fetch,\n    treatments.fetchConfig,\n    dead.fetch,\n  ]),\n  set(state`msg`, { type: 'good', text: 'Computing stats...' }),\n  incoming.computeStats,\n  set(state`recordsValid`, true),\n  set(state`msg`, { type: 'good', text: 'Loaded successfully.'}),\n]);\n","import moment from 'moment';\nimport { set } from 'cerebral/factories';\nimport { state } from 'cerebral/tags';\n\n\nimport treatmentsModule from 'aultfarms-lib/treatments/module';\nimport   incomingModule from 'aultfarms-lib/incoming/module';\nimport       deadModule from 'aultfarms-lib/dead/module';\nimport     trelloModule from 'aultfarms-lib/trello/module';\nimport windowSizeModule from 'aultfarms-lib/windowSize/module';\n\nimport     trelloProvider from 'aultfarms-lib/trello/provider';\nimport windowSizeProvider from 'aultfarms-lib/windowSize/provider';\n\nimport * as trelloErrors from 'aultfarms-lib/trello/module/errors';\n\nimport * as sequences from './sequences';\n\nexport default {\n  sequences,\n  state: { \n    recordsValid: false,\n    treatmentEditorActive: false,\n    historySelector: {\n      active: 'date', // date/tag/group/dead\n    },\n    historyGroup: {\n      sort: 'date', // date/name/dead/perc\n    },\n\n    msg: {\n      type: 'bad',\n      text: 'Treatment record not saved.',\n    },\n\n    record: {\n      date: moment().format('YYYY-MM-DD'),\n      treatment: 'NoExHt',\n      tag: {\n        color: '',\n        number: 0,\n      },\n      is_saved: true,\n    },\n\n  },\n  modules: {\n    treatments: treatmentsModule,\n      incoming: incomingModule,\n          dead: deadModule,\n        trello: trelloModule,\n    windowSize: windowSizeModule,\n  },\n  providers: {\n        trello: trelloProvider,\n    windowSize: windowSizeProvider,\n  },\n  catch: [\n    [ trelloErrors.TrelloSaveError,      [ set(state`msg`, 'ERROR: failed to save in Trello')      ] ],\n    [ trelloErrors.TrelloGetError,       [ set(state`msg`, 'ERROR: failed to get in Trello')       ] ],\n    [ trelloErrors.TrelloAuthorizeError, [ set(state`msg`, 'ERROR: failed to authorize in Trello') ] ],\n  ],\n};\n\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport registerServiceWorker from './registerServiceWorker';\n\nimport App from './App';\nimport AppModule from './module';\n\nimport CerebralApp from 'cerebral';\nimport { Container } from '@cerebral/react';\nimport devtools from 'cerebral/devtools';\n\nimport 'pure-css';\nimport './index.css';\n\nconst controller = CerebralApp(AppModule, {\n  devtools: process.env.NODE_ENV === 'production' ? null : devtools({host: 'localhost:8000', reconnect: true }),\n});\n\n\n// Render the root node:\nReactDOM.render(\n  <Container app={controller}>\n    <App />\n  </Container>, document.getElementById('root')\n);\n\nregisterServiceWorker();\n\n"],"sourceRoot":""}